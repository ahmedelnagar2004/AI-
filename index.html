<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8-Puzzle Solver - A* Algorithm</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body dir="rtl">
    <div id="root"></div>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        const { useState } = React;

        // أيقونات SVG
        const PlayIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3l14 9-14 9V3z"/></svg>;
        const RotateCcwIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 4v6h6M23 20v-6h-6"/><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/></svg>;
        const SkipForwardIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3v18l11-9L5 3zm13 0v18h2V3h-2z"/></svg>;

        const PuzzleSolver = () => {
            const [currentState, setCurrentState] = useState([1, 2, 3, 4, 5, 6, 7, 8, 0]);
            const [solving, setSolving] = useState(false);
            const [solution, setSolution] = useState([]);
            const [currentStep, setCurrentStep] = useState(0);
            const [stats, setStats] = useState(null);

            const goalState = [1, 2, 3, 4, 5, 6, 7, 8, 0];

            // حساب Manhattan Distance (المسافة المانهاتن)
            const manhattanDistance = (state) => {
                let distance = 0;
                for (let i = 0; i < 9; i++) {
                    if (state[i] !== 0) {
                        const goalIndex = goalState.indexOf(state[i]);
                        const currentRow = Math.floor(i / 3);
                        const currentCol = i % 3;
                        const goalRow = Math.floor(goalIndex / 3);
                        const goalCol = goalIndex % 3;
                        distance += Math.abs(currentRow - goalRow) + Math.abs(currentCol - goalCol);
                    }
                }
                return distance;
            };

            // الحصول على الحركات الممكنة
            const getPossibleMoves = (state) => {
                const moves = [];
                const zeroIndex = state.indexOf(0);
                const row = Math.floor(zeroIndex / 3);
                const col = zeroIndex % 3;

                // أعلى
                if (row > 0) moves.push(zeroIndex - 3);
                // أسفل
                if (row < 2) moves.push(zeroIndex + 3);
                // يسار
                if (col > 0) moves.push(zeroIndex - 1);
                // يمين
                if (col < 2) moves.push(zeroIndex + 1);

                return moves;
            };

            // تنفيذ حركة
            const makeMove = (state, from, to) => {
                const newState = [...state];
                [newState[from], newState[to]] = [newState[to], newState[from]];
                return newState;
            };

            // التحقق من إمكانية الحل
            const isSolvable = (state) => {
                let inversions = 0;
                const filtered = state.filter(x => x !== 0);
                for (let i = 0; i < filtered.length; i++) {
                    for (let j = i + 1; j < filtered.length; j++) {
                        if (filtered[i] > filtered[j]) inversions++;
                    }
                }
                return inversions % 2 === 0;
            };

            // خوارزمية A*
            const aStarSearch = () => {
                if (!isSolvable(currentState)) {
                    alert('هذه الحالة غير قابلة للحل!');
                    return null;
                }

                const openList = [];
                const closedList = new Set();
                const startNode = {
                    state: currentState,
                    g: 0,
                    h: manhattanDistance(currentState),
                    f: 0,
                    parent: null
                };
                startNode.f = startNode.g + startNode.h;
                openList.push(startNode);

                let nodesExplored = 0;

                while (openList.length > 0) {
                    // اختيار العقدة بأقل قيمة f
                    openList.sort((a, b) => a.f - b.f);
                    const currentNode = openList.shift();
                    nodesExplored++;

                    const stateKey = currentNode.state.join(',');
                    if (closedList.has(stateKey)) continue;
                    closedList.add(stateKey);

                    // التحقق من الوصول للهدف
                    if (currentNode.state.join(',') === goalState.join(',')) {
                        const path = [];
                        let node = currentNode;
                        while (node) {
                            path.unshift(node.state);
                            node = node.parent;
                        }
                        return { path, nodesExplored, pathLength: path.length - 1 };
                    }

                    // توليد الحالات الفرعية
                    const zeroIndex = currentNode.state.indexOf(0);
                    const possibleMoves = getPossibleMoves(currentNode.state);

                    for (const move of possibleMoves) {
                        const newState = makeMove(currentNode.state, zeroIndex, move);
                        const newStateKey = newState.join(',');

                        if (!closedList.has(newStateKey)) {
                            const g = currentNode.g + 1;
                            const h = manhattanDistance(newState);
                            const f = g + h;

                            openList.push({
                                state: newState,
                                g,
                                h,
                                f,
                                parent: currentNode
                            });
                        }
                    }
                }

                return null;
            };

            const handleSolve = () => {
                setSolving(true);
                setCurrentStep(0);
                const result = aStarSearch();
                if (result) {
                    setSolution(result.path);
                    setStats({
                        nodesExplored: result.nodesExplored,
                        pathLength: result.pathLength
                    });
                }
                setSolving(false);
            };

            const handleShuffle = () => {
                let shuffled = [...goalState];
                // خلط عشوائي يضمن إمكانية الحل
                for (let i = 0; i < 100; i++) {
                    const zeroIndex = shuffled.indexOf(0);
                    const moves = getPossibleMoves(shuffled);
                    const randomMove = moves[Math.floor(Math.random() * moves.length)];
                    shuffled = makeMove(shuffled, zeroIndex, randomMove);
                }
                setCurrentState(shuffled);
                setSolution([]);
                setCurrentStep(0);
                setStats(null);
            };

            const handleNextStep = () => {
                if (currentStep < solution.length - 1) {
                    setCurrentStep(currentStep + 1);
                }
            };

            const displayState = solution.length > 0 ? solution[currentStep] : currentState;

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-pink-900 p-8">
                    <div className="max-w-4xl mx-auto">
                        <h1 className="text-4xl font-bold text-white text-center mb-2">8-Puzzle Solver</h1>
                        <p className="text-xl text-blue-200 text-center mb-8">خوارزمية A* - A* Algorithm</p>

                        <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl">
                            {/* اللوحة */}
                            <div className="grid grid-cols-3 gap-3 w-80 h-80 mx-auto mb-8">
                                {displayState.map((num, idx) => (
                                    <div
                                        key={idx}
                                        className={`flex items-center justify-center text-4xl font-bold rounded-xl transition-all duration-300 ${
                                            num === 0
                                                ? 'bg-transparent'
                                                : 'bg-gradient-to-br from-blue-400 to-purple-500 text-white shadow-lg hover:scale-105'
                                        }`}
                                    >
                                        {num === 0 ? '' : num}
                                    </div>
                                ))}
                            </div>

                            {/* الأزرار */}
                            <div className="flex gap-4 justify-center mb-6 flex-wrap">
                                <button
                                    onClick={handleShuffle}
                                    disabled={solving}
                                    className="flex items-center gap-2 px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-colors disabled:opacity-50"
                                >
                                    <RotateCcwIcon />
                                    خلط جديد
                                </button>
                                <button
                                    onClick={handleSolve}
                                    disabled={solving || solution.length > 0}
                                    className="flex items-center gap-2 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-colors disabled:opacity-50"
                                >
                                    <PlayIcon />
                                    حل بـ A*
                                </button>
                                {solution.length > 0 && (
                                    <button
                                        onClick={handleNextStep}
                                        disabled={currentStep >= solution.length - 1}
                                        className="flex items-center gap-2 px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-semibold transition-colors disabled:opacity-50"
                                    >
                                        <SkipForwardIcon />
                                        الخطوة التالية
                                    </button>
                                )}
                            </div>

                            {/* الإحصائيات */}
                            {stats && (
                                <div className="bg-white/20 rounded-xl p-6 text-white mb-6">
                                    <h3 className="text-xl font-bold mb-4">إحصائيات الحل:</h3>
                                    <div className="grid grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <p className="text-blue-200">عدد الخطوات:</p>
                                            <p className="text-3xl font-bold">{stats.pathLength}</p>
                                        </div>
                                        <div>
                                            <p className="text-blue-200">العقد المستكشفة:</p>
                                            <p className="text-3xl font-bold">{stats.nodesExplored}</p>
                                        </div>
                                    </div>
                                    <div>
                                        <p className="text-blue-200">التقدم:</p>
                                        <p className="text-2xl font-bold">
                                            {currentStep + 1} / {solution.length}
                                        </p>
                                        <div className="w-full bg-white/20 rounded-full h-3 mt-2">
                                            <div
                                                className="bg-gradient-to-r from-green-400 to-blue-500 h-3 rounded-full transition-all duration-300"
                                                style={{ width: `${((currentStep + 1) / solution.length) * 100}%` }}
                                            />
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* معلومات الخوارزمية */}
                            <div className="bg-white/10 rounded-xl p-6 text-white">
                                <h3 className="text-lg font-bold mb-2">كيف تعمل خوارزمية A*؟</h3>
                                <ul className="text-sm text-blue-200 space-y-2">
                                    <li>• تستخدم دالة التقييم: f(n) = g(n) + h(n)</li>
                                    <li>• g(n): التكلفة من البداية إلى العقدة الحالية</li>
                                    <li>• h(n): التقدير للوصول للهدف (Manhattan Distance)</li>
                                    <li>• تختار دائماً العقدة بأقل قيمة f(n)</li>
                                    <li>• تضمن الوصول للحل الأمثل</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PuzzleSolver />);
    </script>
</body>
</html>
